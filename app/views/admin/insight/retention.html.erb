<button onclick="location.href='/admin/users';" class='btn btn-primary' style='margin-top:15px;'>← HOME</button>
<br/>
<br/>
<button class="btn <% if @r == 1 %> btn-success <% end %>" onclick="location.href='/admin/insight/retention'">최근 1주일</button>&nbsp;&nbsp;
<button class='btn <% if @r == 2 %> btn-success <% end %>' onclick="location.href='/admin/insight/retention?recent=month'">최근 1달</button>&nbsp;&nbsp;
<button class='btn <% if @r == 3 %> btn-success <% end %>' onclick="location.href='/admin/insight/retention?recent=all'">전체기간</button>
직접입력&nbsp;&nbsp;
<input type='text' name='date1' class='date' style='width:80px;margin:0;'/> ~ <input type='text' name='date2' class='date' style='width:80px;margin:0;'/>&nbsp;&nbsp;
<button id='date_btn' class='btn'>선택완료</button><br/><br/><br/>
<h3>신규 유저 분석</h3>
<br/>
<table class='table table-hover' style='text-align:center;'>
  <tr>
    <th style='text-align:center;'>가입 날짜</th>
    <th style='text-align:center;'>회원가입</th>
    <th style='text-align:center;'>레벨테스트</th>
    <th style='text-align:center;'>LT 비율</th>
    <th style='text-align:center;'>학습하기(명)</th>
    <th style='text-align:center;'>학습횟수(번)</th>
    <th style='text-align:center;'>학습비율</th>
    <th style='text-align:center;'>1인평균</th>
  </tr>
  <% for row in @logs %>
  <tr>
    <th style='text-align:center;'><%=row[:day]%></th>
    <th style='text-align:center;'><%=row[:user]%>명</th>
    <th style='text-align:center;'><%=row[:lt]%>명</th>
    <th style='text-align:center;'><%=row[:lt]*100/row[:user]%>%</th>
    <th style='text-align:center;'><%=row[:day_0]%>명</th>
    <th style='text-align:center;'><%=row[:cnt_0]%>번</th>
    <th style='text-align:center;'><%=row[:day_0]*100/row[:user]%>%</th>
    <th style='text-align:center;'><%=(row[:cnt_0].to_f/row[:day_0]).round(1)%></th>
  </tr>
  <% end %>
</table>
<br/><br/><br/>
<h3>유저 재학습 분석</h3>
<br/>
<table class='table table-hover' style='text-align:center;'>
  <tr>
    <th style='text-align:center;'>가입 날짜</th>
    <th style='text-align:center;'>1일차</th>
    <th style='text-align:center;'>2일차</th>
    <th style='text-align:center;'>3일차</th>
    <th style='text-align:center;'>4일차</th>
    <th style='text-align:center;'>5일차</th>
    <th style='text-align:center;'>6일차</th>
    <th style='text-align:center;'>7일차</th>
    <th style='text-align:center;'>8일차</th>
    <th style='text-align:center;'>9일차</th>
    <th style='text-align:center;'>10일차</th>
    <th style='text-align:center;'>11일차</th>
    <th style='text-align:center;'>12일차</th>
  </tr>
  <% for row in @logs %>
  <tr>
    <th style='text-align:center;'><%=row[:day]%><br/>재학습인원<br/>재학습횟수<br/>재학습비율<br/>평균학습량</th>
    <td style='text-align:center;'><br/><%=row[:day_1]%>명 학습<br/><%=row[:cnt_1]%>회 학습<br/><%=row[:day_1]*100/row[:user]%>%<br/><%=(row[:cnt_1].to_f/row[:day_1]).round(1) if row[:day_1]!=0%>회</td>
    <td style='text-align:center;'><br/><%=row[:day_2]%>명 학습<br/><%=row[:cnt_2]%>회 학습<br/><%=row[:day_2]*100/row[:user]%>%<br/><%=(row[:cnt_2].to_f/row[:day_2]).round(1) if row[:day_2]!=0%>회</td>
    <td style='text-align:center;'><br/><%=row[:day_3]%>명 학습<br/><%=row[:cnt_3]%>회 학습<br/><%=row[:day_3]*100/row[:user]%>%<br/><%=(row[:cnt_3].to_f/row[:day_3]).round(1) if row[:day_3]!=0%>회</td>
    <td style='text-align:center;'><br/><%=row[:day_4]%>명 학습<br/><%=row[:cnt_4]%>회 학습<br/><%=row[:day_4]*100/row[:user]%>%<br/><%=(row[:cnt_4].to_f/row[:day_4]).round(1) if row[:day_4]!=0%>회</td>
    <td style='text-align:center;'><br/><%=row[:day_5]%>명 학습<br/><%=row[:cnt_5]%>회 학습<br/><%=row[:day_5]*100/row[:user]%>%<br/><%=(row[:cnt_5].to_f/row[:day_5]).round(1) if row[:day_5]!=0%>회</td>
    <td style='text-align:center;'><br/><%=row[:day_6]%>명 학습<br/><%=row[:cnt_6]%>회 학습<br/><%=row[:day_6]*100/row[:user]%>%<br/><%=(row[:cnt_6].to_f/row[:day_6]).round(1) if row[:day_6]!=0%>회</td>
    <td style='text-align:center;'><br/><%=row[:day_7]%>명 학습<br/><%=row[:cnt_7]%>회 학습<br/><%=row[:day_7]*100/row[:user]%>%<br/><%=(row[:cnt_7].to_f/row[:day_7]).round(1) if row[:day_7]!=0%>회</td>
    <td style='text-align:center;'><br/><%=row[:day_8]%>명 학습<br/><%=row[:cnt_8]%>회 학습<br/><%=row[:day_8]*100/row[:user]%>%<br/><%=(row[:cnt_8].to_f/row[:day_8]).round(1) if row[:day_8]!=0%>회</td>
    <td style='text-align:center;'><br/><%=row[:day_9]%>명 학습<br/><%=row[:cnt_9]%>회 학습<br/><%=row[:day_9]*100/row[:user]%>%<br/><%=(row[:cnt_9].to_f/row[:day_9]).round(1) if row[:day_9]!=0%>회</td>
    <td style='text-align:center;'><br/><%=row[:day_10]%>명 학습<br/><%=row[:cnt_10]%>회 학습<br/><%=row[:day_10]*100/row[:user]%>%<br/><%=(row[:cnt_10].to_f/row[:day_10]).round(1) if row[:day_10]!=0%>회</td>
    <td style='text-align:center;'><br/><%=row[:day_11]%>명 학습<br/><%=row[:cnt_11]%>회 학습<br/><%=row[:day_11]*100/row[:user]%>%<br/><%=(row[:cnt_11].to_f/row[:day_11]).round(1) if row[:day_11]!=0%>회</td>
    <td style='text-align:center;'><br/><%=row[:day_12]%>명 학습<br/><%=row[:cnt_12]%>회 학습<br/><%=row[:day_12]*100/row[:user]%>%<br/><%=(row[:cnt_12].to_f/row[:day_12]).round(1) if row[:day_12]!=0%>회</td>
  </tr>
  <% end %>
</table>

<script>
$(document).ready(function() {
  $("#date_btn").click(function(){
    if($("input[name=date1]").val() == "") {
      alert("날짜를 입력해주세요");
      $("input[name=date1]").focus();
      return false;
    }
    if($("input[name=date2]").val() == "") {
      alert("날짜를 입력해주세요");
      $("input[name=date2]").focus();
      return false;
    }
    if(!$("input[name=date1]").val().match(/[0-9]{4}-[0-9]{2}-[0-9]{2}/)) {
      alert("날짜포맷을 확인해주세요. (ex : 2013-12-25)");
      $("input[name=date1]").focus();
      return false;
    }
    if(!$("input[name=date2]").val().match(/[0-9]{4}-[0-9]{2}-[0-9]{2}/)) {
      alert("날짜포맷을 확인해주세요. (ex : 2013-12-25)");
      $("input[name=date2]").focus();
      return false;
    }

    location.href="/admin/insight/retention?start_date="+$("input[name=date1]").val()+"&end_date="+$("input[name=date2]").val();
  });
});
</script>
